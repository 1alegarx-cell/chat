<script>
    // 1. Твой конфиг (оставляем как есть)
    const firebaseConfig = {
        apiKey: "AIzaSyB7bTin28New3YE4GsgTjcJnzllzJn_-YI",
        authDomain: "geroivechnost.firebaseapp.com",
        databaseURL: "https://geroivechnost-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "geroivechnost",
        storageBucket: "geroivechnost.firebasestorage.app",
        messagingSenderId: "571001236869",
        appId: "1:571001236869:web:26d2692cff6b4c49ada8ec"
    };

    // 2. Инициализация Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    // 3. ТОТ САМЫЙ КОД (Ловим результат входа после редиректа)
    auth.getRedirectResult()
        .then((result) => {
            if (result && result.user) {
                console.log("Вход выполнен через Google:", result.user.displayName);
                // Сохраняем имя в память браузера
                localStorage.setItem('user_name', result.user.displayName);
                // Мгновенно переходим в чат
                window.location.href = 'chat.html'; 
            }
        })
        .catch((error) => {
            console.error("Ошибка при возврате от Google:", error);
        });

    // 4. Проверка: если пользователь уже вошел ранее
    auth.onAuthStateChanged((user) => {
        if (user) {
            localStorage.setItem('user_name', user.displayName);
            // Если хочешь, чтобы при заходе на страницу логина залогиненных сразу кидало в чат:
            // window.location.href = 'chat.html';
        }
    });

    // 5. Функция для кнопки "Войти через Google"
    function loginWithGoogle() {
        auth.signInWithRedirect(provider);
    }
</script>
