<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB7bTin28New3YE4GsgTjcJnzllzJn_-YI",
        authDomain: "geroivechnost.firebaseapp.com",
        databaseURL: "https://geroivechnost-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "geroivechnost",
        storageBucket: "geroivechnost.firebasestorage.app",
        messagingSenderId: "571001236869",
        appId: "1:571001236869:web:26d2692cff6b4c49ada8ec"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function signInWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        // Используем Redirect для надежности на всех устройствах
        auth.signInWithRedirect(provider);
    }

    // ГЛАВНЫЙ БЛОК: Ловим пользователя после возврата
    auth.getRedirectResult().then((result) => {
        if (result.user) {
            console.log("Успешный вход!");
            localStorage.setItem('user_name', result.user.displayName);
            window.location.replace('chat.html'); // replace лучше чем href, он не дает вернуться назад
        }
    }).catch((error) => {
        console.error("Ошибка редиректа:", error.message);
    });

    // Дополнительная проверка: если сессия уже активна
    auth.onAuthStateChanged((user) => {
        if (user) {
            localStorage.setItem('user_name', user.displayName);
            window.location.replace('chat.html');
        }
    });

    // Ручной вход
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('username').value;
        localStorage.setItem('user_name', name);
        window.location.href = 'chat.html';
    });
</script>
