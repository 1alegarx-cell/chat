<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ГЕРОИ ВЕЧНОСТЬ | Память павшим в СВО</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            background: radial-gradient(circle at top, #1a1a2e 0%, #0f0f1a 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
            margin-right: 320px; /* Отступ под чат */
            font-family: 'Inter', sans-serif;
        }

        /* Стеклянный чат справа */
        .glass-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 320px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }

        /* Сообщения */
        #side-messages-flow {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mini-msg {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 14px;
            border-radius: 15px;
            border-bottom-left-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 13px;
        }

        .msg-author { font-size: 10px; font-weight: 800; margin-bottom: 2px; text-transform: uppercase; }

        /* Шапка и кнопки сайта */
        .hero-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 12px;
            transition: 0.3s;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            font-size: 13px;
        }
        .hero-btn:hover { background: #007AFF; border-color: #007AFF; box-shadow: 0 0 20px rgba(0, 122, 255, 0.4); }

        input.chat-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 10px 15px;
            color: white;
            outline: none;
        }

        @media (max-width: 900px) {
            body { margin-right: 0; }
            .glass-sidebar { display: none; }
        }
    </style>
</head>
<body>

    <div class="max-w-4xl mx-auto p-8 pt-20 text-center">
        <h1 class="text-6xl font-black mb-2 tracking-tighter uppercase italic">ГЕРОИ ВЕЧНОСТЬ</h1>
        <p class="text-red-500 font-bold tracking-widest mb-10 text-sm uppercase">Память павшим в СВО России</p>
        
        <div class="flex flex-wrap justify-center gap-4 mt-10">
            <button class="hero-btn">Открыть архив</button>
            <button class="hero-btn">Добавить воина</button>
        </div>

        <div id="login-section" class="mt-16">
            <p class="text-gray-500 text-xs mb-4 uppercase tracking-widest">Присоединиться к сообществу</p>
            <button onclick="loginWithGoogle()" class="bg-white text-black px-8 py-3 rounded-full font-bold hover:bg-gray-200 transition uppercase text-xs">
                Вход через Google
            </button>
        </div>
    </div>

    <div class="glass-sidebar">
        <div class="p-5 border-b border-white/10 flex items-center justify-between">
            <span class="text-[10px] font-bold tracking-widest text-white/50 uppercase">Live Общение</span>
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-red-600 rounded-full animate-pulse shadow-[0_0_10px_red]"></span>
            </div>
        </div>

        <div id="side-messages-flow">
            </div>

        <div id="side-input-bar" class="p-5 bg-black/20">
            </div>
    </div>

    <script>
        // Твои настройки Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB7bTin28New3YE4GsgTjcJnzllzJn_-YI",
            authDomain: "geroivechnost.firebaseapp.com",
            databaseURL: "https://geroivechnost-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "geroivechnost",
            storageBucket: "geroivechnost.firebasestorage.app",
            messagingSenderId: "571001236869",
            appId: "1:571001236869:web:26d2692cff6b4c49ada8ec"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const provider = new firebase.auth.GoogleAuthProvider();

        // Вход через Google
        function loginWithGoogle() { auth.signInWithRedirect(provider); }

        auth.getRedirectResult().then((result) => {
            if (result && result.user) {
                localStorage.setItem('user_name', result.user.displayName);
                localStorage.setItem('user_photo', result.user.photoURL);
                window.location.reload();
            }
        });

        // Проверка авторизации
        auth.onAuthStateChanged((user) => {
            const inputBar = document.getElementById('side-input-bar');
            if (user) {
                localStorage.setItem('user_name', user.displayName);
                localStorage.setItem('user_photo', user.photoURL);
                document.getElementById('login-section').style.display = 'none';
                
                inputBar.innerHTML = `
                    <div class="flex gap-2">
                        <input type="text" id="sideInput" placeholder="Написать..." class="chat-input text-xs">
                        <button onclick="sendMsg()" class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center shrink-0">↑</button>
                    </div>
                `;
            } else {
                inputBar.innerHTML = `<button onclick="loginWithGoogle()" class="w-full text-[9px] font-bold text-blue-400 border border-blue-400/20 py-2 rounded-lg uppercase tracking-tighter">Войти, чтобы писать</button>`;
            }
        });

        // Чат в реальном времени
        db.ref("messages").limitToLast(25).on("child_added", (snapshot) => {
            const data = snapshot.val();
            const flow = document.getElementById('side-messages-flow');
            const msgDiv = document.createElement('div');
            msgDiv.className = "mini-msg";
            msgDiv.innerHTML = `
                <div class="flex items-center gap-2 mb-1">
                    <img src="${data.photo || ''}" class="w-4 h-4 rounded-full">
                    <span class="msg-author" style="color: ${stringToColor(data.username)}">${data.username}</span>
                </div>
                <div class="text-white/80">${data.message}</div>
            `;
            flow.appendChild(msgDiv);
            flow.scrollTop = flow.scrollHeight;
        });

        function sendMsg() {
            const input = document.getElementById('sideInput');
            if (input.value.trim() !== "") {
                db.ref("messages").push().set({
                    username: localStorage.getItem('user_name'),
                    message: input.value,
                    photo: localStorage.getItem('user_photo'),
                    timestamp: Date.now()
                });
                input.value = "";
            }
        }

        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
            return `hsl(${Math.abs(hash % 360)}, 70%, 70%)`;
        }
    </script>
</body>
</html>
